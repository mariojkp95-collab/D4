<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>D3 DIAG — v1</title>
<style>
html,body{margin:0;height:100%;background:#111827;color:#e5e7eb;font:16px system-ui}
main{max-width:880px;margin:0 auto;padding:24px}
pre{white-space:pre-wrap;background:#0f172a;border:1px solid #1f2a44;border-radius:8px;padding:12px}
.ok{color:#10b981;font-weight:700}
.err{color:#ef4444;font-weight:700}
.box{margin-top:14px;padding:14px;border:1px dashed #374151;border-radius:8px}
</style>
</head>
<body>
<main>
  <h1>Diagnostica D3</h1>
  <div id="out" class="box">Esecuzione test…</div>
  <pre id="info"></pre>
</main>
<script>
(function(){
  const out = document.getElementById('out');
  const info = document.getElementById('info');
  const BUILD = 'D3-DIAG-1';

  function logInfo(){
    const lines = [
      'BUILD: '+BUILD,
      'URL: '+location.href,
      'LastModified (questa pagina): '+document.lastModified,
      'UserAgent: '+navigator.userAgent
    ];
    info.textContent = lines.join('\n');
  }

  try{
    // test JS
    let okJS = true;

    // test canvas
    const c = document.createElement('canvas');
    c.width = 200; c.height = 100;
    const ctx = c.getContext('2d');
    const okCanvas = !!ctx;

    // disegno una scritta
    if(okCanvas){
      ctx.fillStyle = '#0ea5e9';
      ctx.fillRect(0,0,200,100);
      ctx.fillStyle = '#111827';
      ctx.font = 'bold 16px system-ui';
      ctx.fillText('JS OK • '+BUILD, 10, 26);
      out.innerHTML = '<div class="ok">✔ JS in esecuzione</div>';
      out.appendChild(c);
    }else{
      out.innerHTML = '<div class="err">✖ getContext("2d") ha restituito null</div>';
    }

    // conclusione
    if(okJS && okCanvas){
      const p = document.createElement('p');
      p.innerHTML = 'Se vedi il riquadro azzurro con scritto <b>JS OK • '+BUILD+'</b>, la pagina è aggiornata e lo script gira.';
      out.appendChild(p);
    }
  }catch(e){
    out.innerHTML = '<div class="err">Eccezione JS: '+String(e)+'</div>';
    console.error(e);
  }
  logInfo();
})();
</script>
</body>
</html>
